{% extends 'base.html' %}
{% load humanize %}

{% block content %}
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <!-- Balance Card -->
    <div
        class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden group hover:shadow-md transition-all duration-300">
        <div
            class="absolute top-0 right-0 w-32 h-32 bg-emerald-50 rounded-full -mr-10 -mt-10 transition-transform group-hover:scale-110">
        </div>
        <div class="relative z-10">
            <h3 class="text-slate-500 font-medium text-sm mb-1 uppercase tracking-wider">Total Balance</h3>
            <p class="text-3xl font-bold text-slate-800">Rs {{ balance|intcomma }}</p>
            <div class="mt-4 flex items-center text-sm text-emerald-600 font-medium">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                </svg>
                <span>+12.5%</span> <span class="text-slate-400 font-normal ml-2">from last month</span>
            </div>
        </div>
    </div>

    <!-- Income Card -->
    <div
        class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden group hover:shadow-md transition-all duration-300">
        <div
            class="absolute top-0 right-0 w-32 h-32 bg-blue-50 rounded-full -mr-10 -mt-10 transition-transform group-hover:scale-110">
        </div>
        <div class="relative z-10">
            <h3 class="text-slate-500 font-medium text-sm mb-1 uppercase tracking-wider">Total Income</h3>
            <p class="text-3xl font-bold text-slate-800">Rs {{ total_in|intcomma }}</p>
            <div class="mt-4 flex items-center text-sm text-blue-600 font-medium">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                </svg>
                <span>4 orders</span> <span class="text-slate-400 font-normal ml-2">pending</span>
            </div>
        </div>
    </div>

    <!-- Expense Card -->
    <div
        class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden group hover:shadow-md transition-all duration-300">
        <div
            class="absolute top-0 right-0 w-32 h-32 bg-rose-50 rounded-full -mr-10 -mt-10 transition-transform group-hover:scale-110">
        </div>
        <div class="relative z-10">
            <h3 class="text-slate-500 font-medium text-sm mb-1 uppercase tracking-wider">Total Expenses</h3>
            <p class="text-3xl font-bold text-slate-800">Rs {{ total_out|intcomma }}</p>
            <div class="mt-4 flex items-center text-sm text-rose-600 font-medium">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"></path>
                </svg>
                <span>2.3%</span> <span class="text-slate-400 font-normal ml-2">increase</span>
            </div>
        </div>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Chart Section -->
    <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-bold text-slate-800">Analytics</h3>
            <select
                class="bg-slate-50 border-none text-sm font-medium text-slate-600 rounded-lg focus:ring-emerald-500 cursor-pointer hover:bg-slate-100 transition-colors">
                <option>Last 3 Months</option>
                <option>This Year</option>
            </select>
        </div>
        <div class="h-80 w-full">
            <canvas id="analyticsChart"></canvas>
        </div>
    </div>

    <!-- Recent Transactions -->
    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
        <h3 class="text-lg font-bold text-slate-800 mb-6">Recent Transactions</h3>
        <div class="space-y-4">
            {% for t in transactions %}
            <div class="flex items-center justify-between p-3 rounded-xl hover:bg-slate-50 transition-colors">
                <div class="flex items-center gap-4">
                    <div
                        class="w-10 h-10 rounded-full flex items-center justify-center {% if t.type == 'IN' %}bg-emerald-100 text-emerald-600{% else %}bg-rose-100 text-rose-600{% endif %}">
                        {% if t.type == 'IN' %}
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M7 11l5-5m0 0l5 5m-5-5v12"></path>
                        </svg>
                        {% else %}
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M17 13l-5 5m0 0l-5-5m5 5V6"></path>
                        </svg>
                        {% endif %}
                    </div>
                    <div>
                        <p class="font-medium text-slate-800">
                            {% if t.related_person %}
                            {{ t.related_person }} <span class="text-slate-400 font-normal">({{ t.description }})</span>
                            {% else %}
                            {{ t.description|default:"Transaction" }}
                            {% endif %}
                        </p>
                        <p class="text-xs text-slate-500">{{ t.date|date:"M d, Y" }}</p>
                    </div>
                </div>
                <span class="font-bold {% if t.type == 'IN' %}text-emerald-600{% else %}text-rose-600{% endif %}">
                    {% if t.type == 'IN' %}+{% else %}-{% endif %}Rs {{ t.amount|intcomma }}
                </span>
            </div>
            {% empty %}
            <p class="text-center text-slate-400 py-4">No recent transactions</p>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    // Real Data from Django
    const ctx = document.getElementById('analyticsChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: {{ chart_labels| safe }},
        datasets: [
        {
            label: 'Income',
            data: {{ chart_income| safe }},
        backgroundColor: '#10b981',
        borderRadius: 6,
                },
        {
            label: 'Expense',
            data: {{ chart_expense| safe }},
        backgroundColor: '#cbd5e1',
        borderRadius: 6,
                }
    ]
        },
        options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true,
                grid: {
                    display: true,
                    drawBorder: false,
                    color: '#f1f5f9'
                },
                ticks: {
                    color: '#94a3b8'
                }
            },
            x: {
                grid: {
                    display: false
                },
                ticks: {
                    color: '#94a3b8'
                }
            }
        },
        plugins: {
            legend: {
                display: true,
                position: 'top',
                align: 'end',
                labels: {
                    usePointStyle: true,
                    pointStyle: 'circle',
                    boxWidth: 8
                }
            }
        }
    }
    });
</script>
{% endblock %}